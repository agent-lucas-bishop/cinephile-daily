import type { VercelRequest, VercelResponse } from '@vercel/node';

const TMDB_KEY = process.env.TMDB_API_KEY!;
const TMDB = 'https://api.themoviedb.org/3';
const IMG = 'https://image.tmdb.org/t/p/w185';
const POSTER = 'https://image.tmdb.org/t/p/w500';

const GENRES: Record<number, string> = {
  28: 'Action', 12: 'Adventure', 16: 'Animation', 35: 'Comedy', 80: 'Crime',
  99: 'Documentary', 18: 'Drama', 10751: 'Family', 14: 'Fantasy', 36: 'History',
  27: 'Horror', 10402: 'Music', 9648: 'Mystery', 10749: 'Romance', 878: 'Science Fiction',
  10770: 'TV Movie', 53: 'Thriller', 10752: 'War', 37: 'Western',
};

const DAILY_GENRE_IDS = [28, 12, 16, 35, 80, 18, 10751, 14, 36, 27, 10402, 9648, 10749, 878, 53, 10752, 37];

// MOVIE_POOLS is defined at the bottom of this file (inlined for Vercel serverless compat)
const moviePools = MOVIE_POOLS;

// Seeded PRNG (mulberry32)
function mulberry32(seed: number) {
  return function () {
    let t = (seed += 0x6d2b79f5);
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}

function dateSeed(dateStr: string): number {
  let hash = 0;
  for (let i = 0; i < dateStr.length; i++) {
    hash = ((hash << 5) - hash) + dateStr.charCodeAt(i);
    hash |= 0;
  }
  return Math.abs(hash);
}

async function fetchJson(url: string) {
  const res = await fetch(url);
  if (!res.ok) throw new Error(`TMDB ${res.status}: ${url}`);
  return res.json();
}

function shuffle<T>(arr: T[], rng: () => number): T[] {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(rng() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

/**
 * Pick 3 movie IDs from the static pool using seeded RNG.
 * Fetches release dates to ensure decade diversity.
 */
function pickMovieIds(pool: number[], rng: () => number, count: number): number[] {
  if (pool.length <= count) return pool.slice(0, count);
  const shuffled = shuffle([...pool], rng);
  return shuffled.slice(0, count);
}

// In-memory cache survives across warm invocations
let cachedDate = '';
let cachedResult: any = null;

export default async function handler(req: VercelRequest, res: VercelResponse) {
  try {
    const now = new Date();
    const dateStr = `${now.getUTCFullYear()}-${String(now.getUTCMonth() + 1).padStart(2, '0')}-${String(now.getUTCDate()).padStart(2, '0')}`;

    if (cachedDate === dateStr && cachedResult) {
      const endOfDay = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), 23, 59, 59));
      const maxAge = Math.max(60, Math.floor((endOfDay.getTime() - now.getTime()) / 1000));
      res.setHeader('Cache-Control', `public, s-maxage=${maxAge}, stale-while-revalidate=3600`);
      return res.status(200).json(cachedResult);
    }

    const endOfDay = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), 23, 59, 59));
    const maxAge = Math.max(60, Math.floor((endOfDay.getTime() - now.getTime()) / 1000));
    res.setHeader('Cache-Control', `public, s-maxage=${maxAge}, stale-while-revalidate=3600`);

    const seed = dateSeed(dateStr);
    const rng = mulberry32(seed);

    // Pick today's genre
    const genreIdx = Math.floor(rng() * DAILY_GENRE_IDS.length);
    const genreId = DAILY_GENRE_IDS[genreIdx];
    const genre = GENRES[genreId];

    // Get pool from static data
    const pool = moviePools[String(genreId)] ?? [];
    if (pool.length < 3) {
      return res.status(500).json({ error: `Genre pool too small for ${genre}` });
    }

    // Pick 3 movie IDs deterministically
    const movieIds = pickMovieIds(pool, rng, 3);

    // Fetch full details (these don't change — same movie ID always returns same movie)
    const movies = await Promise.all(movieIds.map(async (movieId) => {
      const [details, keywords, providers] = await Promise.all([
        fetchJson(`${TMDB}/movie/${movieId}?api_key=${TMDB_KEY}&append_to_response=credits`),
        fetchJson(`${TMDB}/movie/${movieId}/keywords?api_key=${TMDB_KEY}`),
        fetchJson(`${TMDB}/movie/${movieId}/watch/providers?api_key=${TMDB_KEY}`),
      ]);

      const director = details.credits?.crew?.find((c: { job: string }) => c.job === 'Director');
      const writers = details.credits?.crew
        ?.filter((c: { department: string }) => c.department === 'Writing')
        ?.slice(0, 3)
        ?.map((c: { name: string }) => c.name) ?? [];
      const cast = (details.credits?.cast ?? []).slice(0, 6).map((c: { name: string; character: string; profile_path: string | null }) => ({
        name: c.name,
        character: c.character,
        profilePath: c.profile_path,
      }));

      return {
        id: details.id,
        title: details.title,
        year: new Date(details.release_date).getFullYear(),
        director: director?.name ?? 'Unknown',
        directorPhoto: director?.profile_path ? `${IMG}${director.profile_path}` : null,
        cast,
        writers: [...new Set(writers)],
        genre: details.genres?.[0]?.name ?? genre,
        tagline: details.tagline ?? '',
        overview: details.overview ?? '',
        plotKeywords: (keywords.keywords ?? []).slice(0, 5).map((k: { name: string }) => k.name),
        posterUrl: details.poster_path ? `${POSTER}${details.poster_path}` : '',
        rating: Math.round((details.vote_average ?? 0) * 10) / 10,
        watchProviders: (() => {
          const us = providers.results?.US;
          if (!us) return [];
          const wp: { id: number; name: string; logoUrl: string; type: 'stream' | 'rent' | 'buy' }[] = [];
          const seen = new Set<number>();
          const add = (arr: { provider_id: number; provider_name: string; logo_path: string }[] | undefined, type: 'stream' | 'rent' | 'buy') => {
            for (const p of arr ?? []) {
              if (!seen.has(p.provider_id)) {
                seen.add(p.provider_id);
                wp.push({ id: p.provider_id, name: p.provider_name, logoUrl: `https://image.tmdb.org/t/p/original${p.logo_path}`, type });
              }
            }
          };
          add(us.flatrate, 'stream');
          add(us.rent, 'rent');
          add(us.buy, 'buy');
          return wp;
        })(),
      };
    }));

    const result = { date: dateStr, movies, genre };
    cachedDate = dateStr;
    cachedResult = result;
    res.status(200).json(result);
  } catch (err) {
    console.error('daily-puzzle error:', err);
    res.status(500).json({ error: 'Failed to generate daily puzzle' });
  }
}

// Auto-generated static movie pools — do not edit manually
// Run scripts/generate-pool.ts to regenerate

const MOVIE_POOLS: Record<string, number[]> = {
  "12": [11, 22, 58, 62, 85, 89, 98, 105, 106, 118, 120, 121, 122, 165, 213, 244, 285, 329, 411, 425, 559, 564, 578, 581, 587, 601, 630, 642, 665, 671, 672, 673, 674, 675, 762, 767, 772, 808, 812, 862, 871, 947, 953, 961, 962, 966, 967, 995, 1368, 1495, 1541, 1654, 1726, 1865, 1891, 1892, 1930, 2493, 3090, 5915, 5925, 7451, 8358, 8587, 9016, 9023, 9340, 9444, 9487, 9806, 9912, 10138, 10191, 10195, 10315, 10674, 11046, 11049, 11362, 11688, 12155, 12403, 12444, 12445, 14160, 14161, 14784, 19995, 24428, 27205, 31682, 36557, 37135, 37724, 38757, 46195, 47971, 49013, 49051, 49521, 57158, 57800, 62177, 68721, 68726, 70981, 76338, 76341, 76600, 82690, 82702, 83533, 87101, 98566, 99861, 100402, 102382, 102651, 102899, 109445, 118340, 122917, 127585, 131631, 135397, 140607, 141052, 150540, 157336, 166426, 166428, 177572, 177677, 181808, 181812, 206647, 207703, 209112, 228326, 260513, 260514, 269149, 271110, 277834, 281957, 283995, 284052, 284053, 284054, 286217, 290859, 293167, 293660, 297762, 297802, 298618, 299054, 299534, 299536, 299537, 301528, 309809, 313106, 313297, 315162, 315635, 320288, 324857, 330457, 330459, 333339, 334533, 335988, 337404, 341013, 346698, 351286, 353081, 354912, 370172, 371645, 381289, 383498, 384018, 399174, 399566, 420809, 420818, 429617, 431693, 436270, 436969, 438631, 441130, 447277, 447365, 453395, 464052, 481848, 497698, 501929, 502356, 505642, 506574, 507086, 508439, 508943, 508965, 515042, 522402, 522518, 524047, 524434, 527774, 530915, 533533, 537061, 539972, 545611, 550205, 550988, 552095, 555604, 558449, 566525, 569094, 572802, 573435, 575264, 575265, 585511, 606856, 617126, 618344, 618588, 629542, 634649, 638507, 640146, 653346, 667538, 675353, 677638, 693134, 698687, 762509, 770254, 786892, 791373, 823464, 840464, 912649, 950387, 961323, 967941, 980489, 986056, 995133, 1011477, 1011985, 1022787, 1022789, 1061474, 1084242, 1087192, 1175942, 1184918, 1234731, 1234821, 1241982, 1242898],
  "14": [22, 58, 118, 120, 121, 122, 137, 141, 162, 244, 251, 252, 268, 285, 297, 310, 408, 411, 433, 492, 497, 561, 564, 587, 601, 620, 628, 630, 671, 672, 673, 674, 675, 762, 765, 767, 808, 809, 810, 812, 854, 856, 927, 1250, 1427, 1585, 1593, 1734, 1865, 2062, 2134, 2280, 2493, 2978, 3933, 4011, 4922, 6477, 8009, 8966, 9016, 9081, 9444, 9479, 9495, 9738, 10020, 10144, 10191, 10192, 10195, 10198, 10437, 10693, 10830, 10849, 10882, 11224, 11236, 11688, 11704, 11787, 11836, 11970, 12092, 12155, 12444, 12445, 13382, 14784, 14836, 16633, 19101, 19995, 20312, 22894, 24021, 24480, 26963, 32085, 32657, 36685, 43074, 49051, 50619, 50620, 57158, 59436, 62177, 72105, 73456, 76338, 76492, 76589, 81188, 82702, 83533, 83564, 102651, 109445, 110416, 116745, 122906, 122917, 137106, 150689, 166426, 178682, 181533, 209112, 214756, 223702, 228326, 246655, 251516, 257344, 259316, 268896, 274857, 278927, 282035, 284052, 287947, 293167, 293863, 297761, 297762, 297802, 309809, 310131, 311324, 315162, 321612, 324544, 330457, 337401, 338953, 338970, 353486, 353491, 375588, 381289, 399055, 402431, 417320, 417859, 420809, 420814, 420817, 425909, 426063, 431580, 438148, 441130, 447273, 447277, 447404, 448119, 451048, 453395, 464052, 487670, 493529, 502356, 503919, 506574, 508439, 508442, 508943, 508947, 508965, 512200, 514754, 527774, 529203, 531219, 537061, 539517, 547016, 550205, 555604, 556901, 566525, 568124, 572802, 585083, 585511, 594767, 599521, 616037, 618344, 634492, 638507, 639720, 639933, 664767, 666243, 763215, 787699, 791373, 803796, 839033, 842924, 845781, 846422, 876716, 877703, 917496, 936108, 950387, 957452, 961323, 967941, 976573, 994108, 995133, 1011985, 1022796, 1062722, 1087192, 1241921, 1241982, 1246049, 1311031],
  "16": [12, 35, 408, 425, 530, 531, 532, 585, 808, 809, 810, 812, 856, 862, 863, 920, 950, 953, 1267, 2062, 3933, 5255, 5559, 6477, 7518, 8355, 8587, 9016, 9023, 9081, 9297, 9325, 9444, 9479, 9487, 9502, 9732, 9806, 9836, 9837, 9928, 9982, 10009, 10020, 10112, 10144, 10191, 10192, 10193, 10198, 10315, 10340, 10386, 10527, 10545, 10555, 10674, 10681, 10693, 10882, 10948, 11049, 11224, 11544, 11688, 11836, 11970, 12092, 12230, 12244, 13002, 13042, 13053, 13151, 13187, 13377, 13413, 13929, 13930, 14160, 14813, 14836, 14919, 15512, 17578, 20352, 22794, 24238, 24480, 32085, 37135, 38055, 38757, 40619, 40662, 44896, 46195, 49013, 49444, 49519, 50359, 57800, 62177, 62211, 73456, 73723, 75258, 76492, 80321, 81188, 82690, 82702, 83564, 93456, 105864, 109445, 110416, 123025, 127380, 137106, 140300, 140420, 142061, 150540, 166428, 177572, 183011, 200481, 223702, 228161, 228165, 228326, 260513, 260514, 269149, 270946, 277834, 278154, 280217, 293299, 297270, 301528, 309809, 313297, 315162, 324849, 324852, 324857, 330457, 335797, 339877, 342473, 354912, 360920, 364689, 378236, 399106, 399174, 404368, 412117, 417859, 420818, 431693, 435129, 438148, 438695, 441130, 454640, 455661, 459151, 482321, 501929, 502356, 508439, 508442, 508943, 508947, 508965, 514754, 519182, 520758, 527774, 529203, 537061, 539517, 550205, 552095, 555604, 556901, 568124, 569094, 570480, 585083, 585511, 598331, 614930, 618344, 629542, 638507, 664767, 677638, 698687, 713776, 748783, 762509, 770254, 774370, 803796, 839033, 869626, 877269, 893723, 929204, 936108, 940551, 961323, 976573, 995133, 1011985, 1022787, 1022789, 1022796, 1064486, 1084242, 1175942, 1184918, 1241982, 1311031, 1376434],
  "18": [13, 14, 15, 28, 38, 73, 76, 78, 98, 103, 111, 141, 162, 197, 207, 238, 240, 242, 251, 272, 274, 278, 279, 284, 289, 311, 345, 350, 389, 423, 424, 489, 497, 510, 524, 550, 595, 597, 599, 600, 629, 640, 641, 644, 655, 705, 744, 745, 769, 787, 821, 857, 871, 901, 949, 962, 975, 1018, 1124, 1359, 1366, 1422, 1495, 1579, 1585, 1813, 1955, 2034, 2118, 2501, 3082, 3175, 4348, 4951, 6479, 7345, 7451, 7485, 8587, 8966, 9277, 9702, 9769, 10098, 10625, 11036, 11324, 11778, 13223, 16869, 19542, 19913, 20334, 21634, 25095, 28178, 37135, 37165, 37257, 37799, 38575, 39254, 43949, 44214, 49026, 50014, 50646, 61791, 62835, 68718, 82633, 84892, 106646, 119450, 120467, 122906, 146233, 150540, 150689, 152601, 157336, 205596, 210577, 216015, 228150, 242582, 244786, 249397, 260514, 263115, 264644, 264660, 273248, 281338, 281957, 286217, 296096, 310131, 313369, 316029, 324786, 329865, 331482, 333371, 334541, 334543, 335984, 337167, 339877, 346364, 348893, 359724, 359940, 361743, 363676, 374720, 381284, 398818, 398978, 400928, 402431, 406997, 419743, 420818, 424694, 447332, 447362, 449176, 450465, 458220, 466272, 466420, 470044, 474350, 475557, 480530, 490132, 508442, 515001, 522518, 522924, 522938, 527641, 530385, 530915, 537061, 537915, 550776, 555604, 558449, 600354, 615777, 619979, 630566, 637649, 646380, 666277, 696374, 724089, 761053, 762975, 776503, 823754, 858024, 872585, 889737, 911430, 929590, 974576, 980489, 1011477, 1033148, 1034716, 1062722, 1064213, 1064486, 1119878, 1184918, 1205515, 1208348, 1214931, 1241983, 1242419, 1252037, 1259102, 1294203, 1317288, 1327862, 1368166, 1419406, 1426776],
  "27": [136, 138, 170, 176, 214, 229, 244, 348, 377, 395, 440, 539, 561, 565, 571, 573, 578, 588, 609, 628, 635, 694, 747, 755, 763, 764, 765, 766, 794, 805, 814, 837, 923, 924, 927, 948, 985, 1091, 1547, 1562, 1694, 1730, 1813, 1923, 1933, 2291, 2654, 2668, 3035, 3053, 4232, 4233, 4234, 4488, 5876, 6114, 6466, 7131, 7340, 8078, 8408, 8413, 9358, 9360, 9378, 9392, 9426, 9532, 9533, 9540, 9542, 9552, 9792, 9902, 10066, 10242, 10331, 10585, 10776, 10787, 10925, 11033, 11167, 11206, 11252, 11336, 11454, 11481, 11549, 11772, 11797, 11815, 11850, 11868, 11974, 13008, 13151, 13186, 13207, 13550, 13666, 13885, 14435, 16307, 16372, 16938, 19908, 19912, 19994, 21208, 21484, 22244, 22894, 22970, 23202, 23823, 27327, 30497, 31682, 31685, 31967, 36586, 36599, 36647, 36685, 39874, 41446, 44214, 46838, 49730, 61012, 64720, 72190, 73935, 76617, 82507, 92060, 126889, 138843, 158015, 238636, 246355, 246403, 246741, 250546, 259693, 263472, 270303, 273477, 282035, 294963, 298250, 300668, 300669, 310131, 333371, 340102, 345940, 346364, 360784, 372343, 381283, 381288, 384521, 395992, 398173, 405774, 419430, 419479, 423108, 426063, 433808, 439079, 443791, 447332, 458305, 458723, 460458, 463821, 474350, 476299, 482373, 493922, 501170, 503736, 507089, 514847, 520763, 524251, 530385, 531219, 531309, 533642, 536554, 539517, 539537, 546121, 567609, 570670, 571055, 574475, 576845, 591274, 591275, 593643, 604079, 615656, 615774, 630586, 631843, 646385, 663712, 713704, 756999, 760104, 762441, 762504, 787752, 791177, 836225, 882598, 894205, 917496, 926899, 933260, 934433, 938614, 945961, 949423, 951491, 957452, 978796, 986097, 1008042, 1010756, 1032823, 1034541, 1038392, 1041613, 1062722, 1064028, 1071215, 1078605, 1083433, 1083968, 1084199, 1100782, 1100988, 1111873, 1114513, 1124620, 1138194, 1151031, 1197137, 1198994, 1226578, 1228246, 1232546, 1233413, 1234731, 1242011, 1246049, 1257009, 1272837, 1302916, 1315303, 1422096],
  "28": [11, 22, 24, 58, 85, 89, 90, 98, 106, 111, 120, 121, 122, 150, 155, 197, 218, 272, 280, 285, 319, 393, 525, 557, 559, 562, 564, 603, 616, 652, 679, 744, 752, 792, 871, 949, 961, 966, 992, 1372, 1495, 1579, 1654, 1726, 1865, 1891, 1892, 1930, 2034, 4638, 4909, 7451, 8681, 9289, 9495, 9502, 9693, 9702, 9806, 10138, 10195, 11046, 11362, 11384, 11474, 11969, 19995, 20352, 24428, 27205, 34851, 36557, 37724, 38234, 39254, 47971, 49026, 49051, 49521, 57158, 59440, 68721, 68726, 72190, 76341, 76600, 82702, 87101, 96721, 98566, 99861, 100402, 102382, 102651, 102899, 109424, 118340, 122917, 123025, 127585, 135397, 137113, 141052, 142061, 156022, 166426, 168259, 176241, 177572, 181808, 181812, 183011, 198663, 206647, 207703, 209112, 228150, 257344, 260513, 263115, 271110, 273481, 283995, 284052, 284053, 284054, 290859, 293167, 293660, 297762, 297802, 298618, 299054, 299534, 299536, 299537, 315635, 320288, 324552, 324857, 330459, 333339, 335983, 337339, 338969, 345887, 346910, 351286, 353081, 359724, 361743, 370172, 383498, 384018, 385687, 399566, 402900, 414419, 416144, 429617, 431693, 436270, 436969, 447365, 453395, 454626, 458156, 464052, 495764, 497698, 505642, 507086, 519182, 524047, 524434, 527774, 530915, 533533, 533535, 537061, 539517, 539972, 541671, 545609, 545611, 552095, 556901, 558449, 566525, 569094, 572802, 573435, 575264, 575265, 603692, 615457, 616037, 617126, 618344, 628847, 629542, 634649, 653346, 664767, 675353, 678512, 718930, 724495, 746036, 749170, 766507, 786892, 791373, 798645, 822119, 823464, 845781, 866398, 882569, 911430, 912649, 939243, 961323, 980489, 986056, 1007734, 1011477, 1011985, 1035259, 1054867, 1061474, 1071585, 1087192, 1119878, 1168190, 1197306, 1223601, 1233413, 1234821, 1242898, 1248226, 1252037, 1257009, 1306368, 1311031, 1363123, 1376434, 1419406],
  "35": [13, 35, 68, 71, 90, 100, 105, 107, 114, 115, 118, 137, 150, 164, 165, 198, 212, 239, 262, 284, 343, 350, 425, 525, 531, 532, 583, 585, 607, 620, 621, 632, 680, 696, 703, 762, 772, 773, 787, 804, 808, 809, 810, 854, 862, 863, 872, 901, 914, 920, 935, 953, 961, 962, 981, 992, 1593, 1633, 2062, 2105, 2108, 2109, 2493, 3034, 3078, 3082, 3083, 4247, 4808, 4951, 7446, 7512, 8355, 8363, 8835, 9277, 9487, 9502, 9637, 9757, 9928, 10098, 10192, 10193, 10315, 10322, 10527, 10625, 10830, 11293, 11384, 11544, 11688, 11787, 11898, 11974, 12153, 12208, 13042, 13187, 13929, 14160, 18785, 19913, 20334, 20352, 22596, 22949, 22970, 24238, 24480, 28978, 32856, 37165, 37247, 38055, 38365, 40619, 43074, 46195, 49013, 49444, 50646, 57800, 62177, 72105, 76492, 80321, 82690, 82702, 83666, 84332, 93456, 98566, 106646, 120467, 140300, 150540, 177572, 178682, 181533, 194662, 200727, 207703, 214756, 225886, 234200, 257211, 257344, 260514, 269149, 270946, 273477, 284053, 287947, 293299, 293660, 301528, 313369, 315162, 324849, 330457, 337404, 338969, 339846, 343668, 346698, 353486, 369557, 371645, 381289, 383498, 384018, 399174, 400928, 402900, 404368, 417859, 425909, 436969, 438148, 438695, 449176, 454619, 454626, 455661, 458897, 466272, 466282, 482321, 490132, 501929, 502356, 508439, 508442, 508933, 508943, 508947, 508965, 512200, 515001, 516729, 519182, 522627, 533535, 542178, 546554, 550205, 550988, 552524, 568124, 573435, 583083, 585083, 585511, 593643, 605722, 615777, 616037, 629542, 639720, 646380, 648878, 661374, 675353, 677638, 696506, 701387, 705861, 718930, 746036, 748783, 749170, 770254, 787699, 792307, 803796, 812583, 823754, 840430, 845781, 868759, 869626, 877817, 897087, 930094, 937278, 939243, 940551, 950387, 961323, 976573, 1011985, 1022787, 1022789, 1029575, 1034716, 1035259, 1064213, 1064486, 1072790, 1084242, 1106289, 1124620, 1161617, 1168190, 1175942, 1195506, 1198994, 1205515, 1208348, 1234731, 1241982, 1242419, 1248226, 1259102, 1363123],
  "36": [117, 197, 205, 279, 424, 522, 568, 606, 612, 625, 642, 652, 665, 676, 711, 746, 783, 820, 821, 826, 853, 855, 857, 873, 921, 947, 967, 978, 1495, 1579, 1779, 1883, 1887, 1904, 1911, 1934, 1955, 1966, 2024, 2289, 3131, 3175, 3683, 4415, 4518, 5653, 5902, 6844, 7214, 8095, 8741, 9361, 9477, 9549, 9665, 9746, 9912, 9918, 10110, 10139, 10142, 10360, 10410, 10423, 10544, 10590, 10858, 10907, 11165, 11202, 11322, 11362, 11416, 11450, 11499, 11646, 11686, 11706, 12524, 12783, 14299, 14433, 14534, 14574, 16052, 18320, 20662, 21634, 21641, 22954, 26428, 33157, 33602, 38543, 42661, 45269, 57212, 68730, 72976, 76203, 76649, 80278, 82695, 96724, 115782, 127372, 140823, 152532, 152760, 167073, 169881, 205596, 205775, 245168, 253412, 261023, 270487, 273895, 277216, 284689, 285783, 289222, 292011, 300671, 302401, 309299, 310307, 314095, 314365, 319888, 321697, 323677, 324786, 331482, 339259, 339380, 339877, 351339, 353326, 354859, 359724, 363676, 365620, 369972, 375262, 381284, 384680, 393624, 398978, 399404, 401200, 402529, 402897, 403300, 407448, 411728, 412924, 416144, 429351, 433247, 446354, 446791, 451480, 454652, 457136, 466420, 467244, 487558, 490132, 491283, 491480, 501907, 502425, 504949, 506528, 517412, 522162, 522212, 530915, 531876, 535544, 543580, 549559, 551332, 556984, 567965, 583406, 614560, 614917, 614934, 617653, 626332, 644495, 707103, 715931, 724495, 726759, 753342, 760329, 760774, 792293, 821881, 832964, 837881, 844185, 850165, 854239, 858024, 862557, 872585, 878361, 964980, 975511, 998846, 1002185, 1013601, 1016084, 1061699, 1182047, 1195631, 1214931],
  "37": [33, 288, 301, 576, 581, 642, 922, 966, 995, 1406, 1656, 1712, 1936, 1969, 2023, 2055, 2362, 3088, 3089, 3090, 3110, 3114, 4476, 4512, 4929, 5176, 5698, 6038, 6529, 6643, 6644, 6977, 7870, 8043, 8053, 8388, 8487, 8584, 8879, 9023, 9086, 9333, 9359, 9588, 10046, 10212, 10213, 10380, 10747, 10891, 10935, 11040, 11072, 11209, 11259, 11509, 11536, 11577, 11694, 11697, 11853, 11897, 11901, 11916, 11943, 11967, 11969, 12106, 12146, 12160, 12501, 12583, 12584, 12639, 12690, 13249, 13496, 13909, 14168, 14342, 14384, 14551, 14554, 14677, 14729, 14881, 15263, 15573, 16211, 16563, 16608, 17456, 17529, 17538, 17664, 18118, 18647, 19592, 20391, 20442, 20533, 21355, 21717, 22201, 22267, 22383, 22660, 23330, 24748, 25599, 26593, 26596, 27277, 27945, 29005, 29244, 30462, 35588, 36206, 37292, 37347, 38765, 44264, 44896, 46429, 46528, 49849, 57120, 57201, 68718, 68818, 82633, 151933, 152748, 158916, 174751, 188161, 223485, 259611, 264656, 273248, 281957, 291356, 294963, 298382, 324544, 324560, 333386, 333484, 338766, 347969, 354110, 384680, 400090, 440161, 453278, 492565, 498743, 501395, 506281, 537996, 538225, 541560, 558582, 581032, 596161, 600583, 618162, 637693, 648878, 698508, 749274, 785663, 843380, 872954, 892153, 932086],
  "53": [63, 77, 78, 106, 117, 155, 161, 169, 170, 213, 218, 223, 242, 247, 251, 274, 275, 280, 303, 322, 345, 393, 426, 500, 521, 539, 550, 553, 562, 567, 571, 578, 604, 629, 638, 678, 679, 680, 694, 702, 745, 752, 782, 787, 793, 805, 807, 819, 820, 829, 845, 891, 910, 948, 954, 963, 968, 982, 993, 996, 1018, 1092, 1359, 1368, 1372, 1422, 1480, 1573, 1580, 1592, 1632, 1700, 1933, 1949, 1954, 2118, 2501, 2649, 3112, 4553, 4909, 5548, 6075, 6479, 6977, 7451, 7485, 8681, 9366, 9495, 9659, 9693, 9702, 10242, 10331, 10633, 10734, 10843, 11324, 11362, 11474, 11974, 12403, 13207, 13528, 14580, 15794, 16869, 17057, 21734, 22832, 23168, 27578, 34851, 36557, 37724, 38234, 38700, 44214, 45612, 48138, 49026, 49530, 59967, 61012, 61791, 62835, 64690, 70160, 71859, 72190, 75656, 82507, 87101, 92060, 109424, 119450, 131631, 135397, 138843, 146233, 156022, 168259, 176241, 198663, 204082, 205596, 206647, 210577, 216015, 242582, 245891, 260346, 262543, 264644, 265208, 273481, 290859, 291805, 299054, 300671, 324552, 333371, 337339, 341013, 345887, 346364, 346910, 348893, 351286, 359410, 370172, 379170, 381288, 385687, 414906, 416144, 419430, 423108, 425274, 450465, 458156, 466272, 474350, 475557, 484641, 489999, 493922, 500664, 507089, 514847, 520763, 522938, 524047, 539972, 541671, 545609, 552178, 573435, 575264, 575265, 577922, 603692, 604079, 615457, 619979, 628847, 631843, 637649, 645710, 698948, 701387, 718930, 725201, 726759, 749170, 755898, 756999, 760104, 762441, 766507, 798645, 801335, 812583, 822119, 840464, 840705, 866398, 870028, 882569, 889737, 926393, 933260, 934433, 950396, 974576, 985939, 1007734, 1010756, 1054867, 1064028, 1071585, 1084199, 1087891, 1097549, 1100988, 1119878, 1125899, 1138194, 1182387, 1196573, 1197137, 1197306, 1198994, 1228246, 1233413, 1272837, 1306368, 1315303, 1368166, 1376434, 1419406, 1426776],
  "80": [16, 24, 90, 93, 100, 103, 107, 111, 115, 117, 150, 155, 161, 176, 185, 186, 187, 212, 235, 238, 239, 240, 242, 247, 268, 272, 274, 275, 278, 311, 319, 320, 322, 393, 414, 475, 497, 500, 521, 524, 525, 553, 592, 627, 629, 640, 641, 642, 650, 654, 678, 680, 754, 755, 769, 793, 807, 819, 829, 845, 854, 856, 903, 910, 949, 963, 968, 993, 996, 1051, 1359, 1422, 1480, 1541, 1580, 1592, 1607, 1632, 1646, 1701, 1949, 2034, 2109, 2118, 3001, 3112, 3131, 3133, 3529, 3580, 4232, 4638, 4982, 5289, 5924, 6075, 6977, 7451, 8321, 8333, 8909, 9040, 9277, 9366, 9516, 9559, 9702, 9737, 9739, 10528, 10633, 10764, 10778, 11016, 11293, 11384, 11798, 11898, 12096, 12153, 13528, 14580, 14919, 15584, 15794, 16958, 18892, 22803, 23168, 23483, 37136, 37257, 38234, 38700, 39514, 40662, 44639, 47971, 49026, 59859, 62835, 64688, 64690, 65754, 75656, 75780, 82633, 82675, 85889, 97020, 106646, 138832, 146233, 156022, 168259, 168672, 169917, 198184, 207703, 241554, 242582, 265208, 273481, 276907, 291805, 302946, 308266, 324552, 337170, 337339, 337404, 339403, 339692, 339846, 343611, 343668, 345887, 359940, 372343, 379149, 379170, 382614, 385128, 385687, 390043, 392044, 395834, 395990, 396371, 398978, 400535, 402900, 414419, 414906, 425274, 438650, 438689, 445571, 449443, 458156, 466420, 470044, 473033, 475557, 483906, 487558, 495764, 497582, 503736, 505026, 512195, 522212, 522627, 534490, 541671, 546554, 550776, 559969, 573435, 582014, 603692, 617502, 628847, 629542, 637649, 648878, 661374, 668489, 697843, 736073, 744653, 800158, 801335, 818397, 866398, 870028, 877817, 889737, 894169, 926393, 934433, 941109, 945729, 974635, 1032823, 1035259, 1054867, 1106289, 1168190, 1175942, 1182387, 1196573, 1197306, 1226578, 1242419, 1242434, 1245993, 1306368, 1419406, 1426776],
  "878": [11, 38, 62, 63, 68, 78, 105, 106, 154, 165, 169, 170, 180, 185, 196, 199, 218, 229, 280, 329, 348, 530, 557, 558, 559, 601, 602, 603, 604, 644, 679, 686, 752, 782, 828, 840, 841, 861, 871, 923, 985, 1091, 1124, 1724, 1726, 1891, 1892, 1893, 1895, 1927, 1930, 1954, 2134, 2666, 2756, 3035, 5548, 6479, 7249, 7512, 8337, 8810, 9016, 9426, 9659, 9693, 9928, 10138, 10386, 10681, 10787, 11049, 11549, 13060, 13183, 13363, 13413, 13475, 14161, 16234, 16320, 17431, 17654, 19995, 20352, 20526, 24428, 27205, 30061, 31011, 31682, 34851, 36685, 38055, 39254, 45612, 49521, 49530, 49538, 54138, 61791, 68721, 68726, 70160, 70981, 72190, 75612, 76341, 76589, 76600, 83533, 84332, 87101, 91314, 98566, 99861, 100402, 101299, 102382, 102899, 118340, 119450, 123025, 126889, 127585, 131631, 135397, 137113, 140607, 141052, 142061, 152601, 157336, 158852, 181808, 181812, 183011, 198184, 198663, 206487, 240832, 244267, 246655, 251516, 257344, 262543, 263115, 264660, 271110, 281338, 283995, 284053, 284054, 286217, 290859, 298618, 299534, 299536, 299537, 300668, 313106, 315635, 315837, 320288, 324857, 329865, 330459, 333339, 333371, 335983, 335984, 335988, 338969, 339964, 345940, 346910, 348350, 351286, 363088, 373571, 379291, 387426, 399566, 399579, 408220, 408647, 416494, 424783, 425909, 427641, 429617, 436270, 438148, 438631, 447332, 447365, 450465, 454626, 460458, 482321, 487670, 497698, 500664, 505642, 507086, 519182, 520763, 522402, 524047, 524434, 533533, 533535, 537061, 545611, 550988, 552524, 556901, 569094, 577922, 580489, 587792, 588228, 604079, 605722, 615656, 617126, 624860, 634649, 640146, 646380, 653346, 667538, 693134, 695721, 696506, 698687, 701387, 736069, 755898, 762441, 766507, 786892, 792307, 798645, 818750, 822119, 823464, 831405, 840464, 912649, 933260, 939243, 945961, 950396, 986056, 1022787, 1061474, 1064028, 1071585, 1084199, 1100988, 1184918, 1234821, 1242898, 1257009, 1272837, 1376434],
  "9648": [15, 62, 63, 77, 93, 141, 152, 167, 176, 186, 192, 223, 251, 260, 303, 322, 345, 381, 402, 426, 473, 506, 539, 565, 567, 574, 588, 591, 592, 617, 622, 635, 638, 686, 745, 782, 793, 807, 829, 837, 891, 910, 940, 963, 992, 993, 1018, 1052, 1091, 1092, 1124, 1586, 1592, 1594, 1632, 1813, 1844, 1847, 1903, 1923, 1933, 1939, 1949, 2059, 2118, 2252, 2291, 2501, 2503, 2649, 2654, 2666, 2667, 2668, 2832, 3009, 3021, 3049, 3529, 3580, 3597, 3766, 4174, 4176, 4192, 4232, 4233, 4234, 4771, 4808, 5236, 6037, 8338, 8413, 9286, 9358, 9504, 9637, 9645, 9741, 10066, 10403, 10440, 10528, 10633, 10982, 11020, 11252, 11324, 11371, 11462, 11507, 11644, 11704, 11901, 11929, 11963, 12096, 12101, 12403, 13027, 13151, 13183, 13448, 13483, 13528, 13811, 14447, 14919, 15196, 16372, 17057, 17578, 19912, 21734, 22244, 22787, 22970, 27576, 36599, 37233, 37257, 37686, 39939, 40662, 41446, 45612, 48138, 49730, 51876, 55779, 58574, 61012, 65754, 70981, 75612, 82507, 84287, 87516, 123025, 142061, 158852, 169917, 171274, 198663, 201085, 206563, 207932, 210577, 225574, 249397, 262504, 270303, 270487, 273248, 298250, 302528, 317091, 329865, 331962, 334074, 339877, 340837, 346685, 372343, 379170, 392044, 395834, 395992, 399035, 401371, 401981, 406990, 411728, 414906, 419430, 420821, 423108, 425274, 428449, 433808, 445571, 458305, 458723, 463821, 471506, 476299, 484247, 489999, 493922, 497582, 505026, 522681, 524251, 530385, 537056, 539537, 546554, 574475, 576845, 579047, 591274, 591275, 619730, 619778, 619979, 631843, 646385, 661374, 664469, 682507, 713364, 726209, 736073, 736074, 744653, 768362, 799876, 812583, 829280, 840705, 866463, 870028, 882598, 945729, 951491, 974250, 974453, 974573, 986097, 1001835, 1041613, 1052280, 1071215, 1078605, 1083433, 1084242, 1098006, 1100782, 1168190, 1226578, 1232546, 1233575, 1290879, 1368166],
  "10402": [27, 65, 69, 71, 88, 243, 279, 525, 704, 786, 824, 1125, 1584, 1677, 1808, 1931, 2005, 2179, 2210, 2750, 2769, 3121, 3179, 3537, 3682, 3902, 5123, 5723, 6279, 6282, 6575, 8328, 8872, 8873, 9037, 9591, 9684, 9762, 9816, 10028, 10060, 10186, 10197, 10437, 10537, 10654, 10784, 10947, 11009, 11031, 11049, 11054, 11172, 11176, 11314, 11326, 11424, 11568, 11663, 11827, 11887, 12104, 12105, 12182, 12335, 12508, 12614, 12637, 12763, 13062, 13192, 13320, 13368, 13497, 13576, 13595, 13649, 13655, 13933, 13938, 14024, 14299, 14410, 15121, 15157, 15392, 15947, 16052, 16367, 16620, 17332, 18126, 20343, 21724, 22582, 23398, 24128, 24961, 25196, 26320, 27327, 27586, 28032, 28971, 32823, 35558, 37719, 41592, 43939, 44244, 46929, 49948, 52959, 55301, 60405, 64328, 65218, 68817, 80585, 84334, 85446, 86829, 89185, 90125, 92060, 114150, 136799, 164558, 177888, 198277, 201676, 209361, 209451, 239566, 243683, 244786, 253414, 254470, 256924, 258509, 271714, 275601, 277216, 277217, 300666, 301351, 302429, 319075, 327331, 331781, 332562, 333667, 335797, 341012, 341689, 352492, 353616, 354279, 354912, 369557, 382399, 402529, 407655, 412924, 417320, 419700, 424694, 426249, 429202, 438695, 440918, 446893, 454458, 470878, 472424, 491283, 501979, 502033, 504608, 504827, 506574, 507256, 508442, 515195, 523607, 531454, 537061, 537116, 570480, 583689, 585244, 592863, 603519, 606117, 606679, 612706, 614934, 615667, 615904, 622855, 630566, 653567, 653664, 654754, 661539, 696157, 707886, 739993, 776503, 799766, 802219, 803796, 817758, 830784, 901362, 928344, 957457, 998846, 1022256, 1027014, 1038263, 1160164, 1230368],
  "10749": [13, 27, 38, 69, 76, 80, 88, 114, 137, 142, 162, 164, 198, 223, 239, 251, 284, 289, 297, 303, 319, 343, 409, 426, 453, 454, 508, 509, 597, 621, 631, 639, 654, 676, 688, 696, 703, 713, 744, 770, 782, 796, 804, 809, 812, 824, 851, 853, 854, 872, 887, 900, 901, 907, 921, 961, 981, 990, 1544, 1581, 1587, 1824, 1879, 1904, 2105, 2251, 2493, 3001, 3078, 3082, 3084, 3175, 3933, 4347, 4348, 4564, 4584, 4808, 4922, 4951, 6114, 6282, 6557, 6620, 6972, 8966, 9361, 9390, 9441, 9476, 9489, 9602, 9732, 9769, 9778, 9820, 9880, 9919, 10020, 10028, 10198, 10229, 10340, 10591, 10691, 10882, 11036, 11054, 11113, 11224, 11631, 11860, 11970, 12163, 12405, 14438, 14709, 14811, 14919, 15121, 16633, 17057, 18239, 18240, 19542, 19913, 20334, 21542, 22538, 22596, 24021, 25095, 25188, 26371, 28971, 28978, 29845, 31011, 31685, 32856, 34016, 37247, 38543, 41630, 43347, 43949, 49730, 50544, 50546, 50619, 50620, 50646, 55721, 59436, 64682, 73935, 82693, 83666, 84332, 102651, 114150, 122906, 132344, 140420, 150689, 152601, 200481, 200727, 216015, 222935, 228205, 232672, 242042, 254320, 256591, 258480, 259694, 266856, 271718, 274870, 296096, 313369, 321612, 331482, 332562, 337167, 341174, 342470, 359784, 369557, 398818, 399055, 402431, 417261, 417870, 419478, 419743, 420817, 426618, 428493, 438689, 447277, 447362, 449176, 454619, 454983, 455207, 455661, 466282, 515195, 522924, 523781, 527641, 537915, 550205, 583083, 585244, 587792, 614409, 615665, 630566, 632322, 666277, 682507, 696374, 698508, 710356, 718032, 724089, 744114, 746036, 753342, 761053, 762975, 776503, 791177, 792307, 828613, 843527, 858024, 868759, 884605, 930094, 937287, 950396, 967941, 974635, 976573, 1014590, 1034716, 1064213, 1072790, 1096342, 1097549, 1136867, 1181678, 1241921, 1242011, 1246049, 1259102, 1294203, 1302916, 1327862],
  "10751": [12, 35, 118, 252, 408, 411, 425, 433, 530, 531, 532, 585, 601, 630, 756, 771, 772, 788, 808, 809, 810, 812, 862, 863, 879, 920, 950, 953, 1265, 1585, 1593, 1885, 2062, 2493, 5123, 5255, 5559, 6477, 8355, 8587, 8839, 8871, 8920, 9016, 9023, 9325, 9340, 9444, 9479, 9487, 9502, 9732, 9806, 9820, 9837, 9928, 10009, 10020, 10112, 10144, 10191, 10192, 10193, 10198, 10315, 10340, 10386, 10437, 10527, 10545, 10555, 10674, 10681, 10693, 10830, 10882, 11224, 11236, 11528, 11544, 11688, 11704, 11836, 11881, 11886, 11970, 12092, 12155, 12230, 12837, 13002, 13004, 13042, 13053, 13060, 13151, 13187, 13377, 13382, 13413, 13929, 13930, 13932, 14160, 14447, 14813, 14836, 15121, 15157, 15165, 15512, 19101, 20352, 21032, 21542, 22949, 24480, 26736, 26963, 28178, 32657, 37135, 38055, 38575, 38757, 40619, 44826, 44896, 46195, 49013, 49444, 49519, 50359, 57800, 62177, 62211, 73456, 73723, 76492, 80321, 81188, 82690, 82702, 83564, 93456, 102651, 105864, 109445, 110416, 127380, 137106, 140300, 140420, 150540, 150689, 158852, 166428, 177572, 178682, 181533, 196867, 228161, 228203, 228326, 260513, 260514, 269149, 270946, 277834, 278154, 278927, 283366, 293299, 297270, 301528, 308531, 309809, 313297, 315162, 321612, 324849, 324852, 330457, 335797, 339984, 342473, 345938, 346648, 354912, 360920, 364689, 378236, 381289, 382748, 399106, 400160, 404368, 404378, 406997, 417320, 417859, 420809, 420814, 420817, 420818, 431580, 431693, 435129, 438148, 438695, 441130, 447273, 447277, 448119, 451048, 454626, 454640, 459151, 481848, 482321, 502356, 506574, 508439, 508442, 508570, 508763, 508943, 508947, 508965, 514754, 516729, 519182, 520758, 522518, 527774, 529203, 531219, 532639, 550205, 552095, 552524, 556901, 560057, 568124, 585083, 592834, 606856, 615666, 629542, 638507, 639720, 675353, 675445, 677638, 698687, 748783, 762509, 770254, 787699, 869626, 876716, 877269, 893723, 929204, 936108, 939243, 940551, 950387, 961323, 976573, 995133, 1011985, 1022787, 1022789, 1022796, 1029575, 1075794, 1084242, 1087192, 1125257, 1175942, 1184918, 1241982, 1248226],
  "10752": [25, 28, 67, 143, 197, 198, 205, 409, 423, 424, 600, 616, 625, 632, 651, 652, 676, 770, 792, 801, 826, 853, 855, 857, 907, 914, 935, 947, 961, 967, 975, 1116, 1251, 1271, 1368, 1369, 1370, 1495, 1654, 1770, 1880, 1966, 2024, 2253, 2289, 2604, 3063, 3175, 3683, 4476, 5902, 5925, 6106, 6415, 7445, 7446, 7555, 8007, 8619, 8665, 8738, 8741, 8880, 8881, 8916, 8963, 9093, 9104, 9255, 9289, 9361, 9477, 9567, 9595, 9665, 9952, 10015, 10047, 10110, 10142, 10364, 10590, 10684, 10687, 10911, 11046, 11165, 11202, 11296, 11422, 11426, 11589, 11646, 11706, 11778, 11780, 12162, 12576, 13813, 14433, 14574, 15764, 16113, 16869, 17360, 19067, 19382, 22584, 22971, 22972, 28966, 33157, 38540, 39312, 53182, 57212, 62630, 72431, 75674, 127372, 152760, 162215, 190859, 193756, 205596, 225728, 227306, 228150, 252178, 256917, 256962, 263614, 271674, 281338, 283587, 284689, 289222, 293767, 300671, 316152, 321751, 324786, 333352, 334517, 339259, 339987, 340945, 351339, 354287, 369885, 374720, 390054, 403300, 405775, 407375, 424488, 426618, 429351, 433247, 433502, 435129, 438799, 454227, 468224, 475132, 504949, 515001, 516486, 522162, 530915, 531876, 543580, 567189, 581859, 597922, 653851, 675327, 715931, 717930, 724495, 736069, 753342, 779816, 799583, 832964, 882569, 896151, 929590, 948713, 969492, 1043905, 1061699, 1223601, 1241436, 1252037, 1257009],
};
